<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>How To Make Naz Happy?</title>
  <style>
    :root{
      --ink:#0f1322; --panel:#ffffff; --border:#e6e8f2;
      --good:#10b981; --bad:#ef4444; --accent:#3b82f6;
    }
    body{margin:0;font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;transition:background .35s ease}
    body[data-mood="sad3"]{background:#1a0e16;} /* En üzgün - En koyu */
    body[data-mood="sad2"]{background:#162032;} /* Çok üzgün */
    body[data-mood="sad1"]{background:#41485f;} /* Üzgün - Ara ton */
    body[data-mood="neutral"]{background:#f6f8ff;} /* Nötr */
    body[data-mood="mutlu1"]{background:#ecfff6;} /* Mutlu */
    body[data-mood="mutlu2"]{background:#fff7e0;} /* Çok mutlu */
    body[data-mood="mutlu3"]{background:#fff0c7;} /* En mutlu - En parlak */

    .wrap{min-height:100dvh;display:grid;grid-template-columns:320px 1fr}
    aside{background:var(--panel);border-right:1px solid var(--border);display:flex;align-items:center;justify-content:center;padding:20px}
    .avatar-large{width:100%;max-width:300px;border-radius:20px;overflow:hidden;display:grid;place-items:center;background:#f1f3fe;border:1px solid var(--border)}
    .avatar-large img{width:100%;height:auto;object-fit:cover}

    main{display:flex;align-items:center;justify-content:center;padding:28px}
    .panel{width:min(600px,100%);background:var(--panel);border:1px solid var(--border);border-radius:16px;box-shadow:0 6px 18px rgba(0,0,0,.08);padding:24px;display:grid;gap:18px}
    h1{margin:0;font-size:22px;text-align:center;color:var(--ink)}
    .mood-label{text-align:center;font-size:14px;color:#555;margin-top:6px}

    .question{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:center;font-size:36px;font-weight:800;color:#111}
    .answer{display:flex;justify-content:center}
    .answer input{width:160px;font-size:28px;padding:10px 14px;border-radius:12px;border:1px solid var(--border);text-align:center;}

    .actions{display:flex;gap:10px;justify-content:center}
    .btn{border:1px solid var(--border);background:#111827;color:#fff;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600}
    .btn.secondary{background:#f9fafb;color:#111}

    .stats{text-align:center;color:#333}
    .stats strong{color:#111}

    @media(max-width:768px){.wrap{grid-template-columns:1fr;grid-template-rows:auto 1fr}aside{border-right:none;border-bottom:1px solid var(--border)}}
    .avatar-jump {
  animation: jump 0.6s ease-out;
}

.avatar-shake {
  animation: shake 0.5s cubic-bezier(.36,.07,.19,.97);
}

@keyframes jump {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-30px);
  }
}

@keyframes shake {
  10%, 90% {
    transform: translateX(-2px);
  }
  20%, 80% {
    transform: translateX(4px);
  }
  30%, 50%, 70% {
    transform: translateX(-6px);
  }
  40%, 60% {
    transform: translateX(6px);
  }
}

.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(15, 19, 34, 0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  backdrop-filter: blur(5px);
}

.end-game-card {
  background: var(--panel);
  padding: 30px 40px;
  border-radius: 16px;
  text-align: center;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  display: grid;
  gap: 15px;
  max-width: 400px;
}

.end-game-card h2 {
  margin: 0;
  font-size: 32px;
  color: var(--ink);
}

.end-game-card p {
  margin: 0;
  color: #555;
  font-size: 18px;
}

  </style>
</head>

<body data-mood="neutral">
  <div class="wrap">
    <aside>
      <div>
        <div class="avatar-large" id="avatar"></div>
        <div class="mood-label" id="moodLabel">Neutral</div>
      </div>
    </aside>
    <main>
      <section class="panel">
        <h1>How To Make Naz Happy?</h1>
        <div class="question" id="question"></div>
        <div class="answer"><input id="answerInput" inputmode="numeric" autocomplete="off" placeholder="cevap" /></div>
        <div class="actions">
          <button class="btn" id="submitBtn">Cevabı Kontrol Et</button>
          <button class="btn secondary" id="skipBtn">Pas Geç</button>
        </div>
        <div class="stats">Doğru: <strong id="okCount">0</strong> · Yanlış: <strong id="failCount">0</strong> · Seri: <strong id="streak">0</strong></div>
      </section>
    </main>
  </div>

  <script>
    const MOODS=[
      {key:'sad3',label:'Naz birazdan kalkıp birini s*kecek 😥😭',emoji:'😭'},
      {key:'sad2',label:'😡😡',emoji:'😡'},
      {key:'sad1',label:'yanlış??😒',emoji:'☹️'},
      {key:'neutral',label:'Selam soruları çözmemde yardımcı olur musun',emoji:'😐'},
      {key:'mutlu1',label:'Doğru Cevap!! ☺️',emoji:'🙂'},
      {key:'mutlu2',label:'YİNE DOĞRU CEVAP 😄 ',emoji:'😄'},
      {key:'mutlu3',label:'🥳🥳🥳',emoji:'😄'}
    ];
    const state={
    name:'Naz', moodIndex:3, ok:0, fail:0, streak:0, 
    difficulty:1, current:null, 
    winStreak: 0, // YENİ: Kazanma serisi sayacı
    loseStreak: 0 // YENİ: Kaybetme serisi sayacı
};

// YENİ: 5 farklı ses efektini tanımla
const sounds = {
    correct: new Audio('sounds/correct.mp3'),
    wrong: new Audio('sounds/wrong.mp3'),
    win: new Audio('sounds/win.mp3'),
    lose: new Audio('sounds/lose.mp3'),
    neutral: new Audio('sounds/neutral.mp3')
};

    let audioCtx;function beep(type='good'){try{if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)();const o=audioCtx.createOscillator();const g=audioCtx.createGain();o.connect(g);g.connect(audioCtx.destination);const good=type==='good';o.type=good?'triangle':'square';o.frequency.value=good?880:240;g.gain.value=.0001;const t=audioCtx.currentTime;g.gain.exponentialRampToValueAtTime(good?0.12:.08,t+.01);g.gain.exponentialRampToValueAtTime(.0001,t+.25);o.start();o.stop(t+.26)}catch(e){}}

    const avatarEl=document.getElementById('avatar');
    const moodLabelEl=document.getElementById('moodLabel');
    const questionEl=document.getElementById('question');
    const answerInput=document.getElementById('answerInput');
    const submitBtn=document.getElementById('submitBtn');
    const skipBtn=document.getElementById('skipBtn');
    const okCountEl=document.getElementById('okCount');
    const failCountEl=document.getElementById('failCount');
    const streakEl=document.getElementById('streak');

    function moodImagePath(){const key=MOODS[state.moodIndex].key;return `images/${key}.jpg`;}

    function preloadImages() {
      console.log('Tüm ruh hali görüntüleri önceden yükleniyor...');
      MOODS.forEach(mood => {
      const img = new Image();
      img.src = `images/${mood.key}.jpg`;
      });
    }
    function renderMood(){
      document.body.setAttribute('data-mood',MOODS[state.moodIndex].key);
      avatarEl.innerHTML='';
      const img=new Image();
      img.src=moodImagePath();
      img.alt=state.name;
      img.onload=()=>{avatarEl.appendChild(img)};
      img.onerror=()=>{avatarEl.innerHTML=`<span>${MOODS[state.moodIndex].emoji}</span>`};
      moodLabelEl.textContent=MOODS[state.moodIndex].label;
    }
    function playSound(soundKey) {
    try {
        const sound = sounds[soundKey];
        if (sound) {
            sound.currentTime = 0;
            sound.play();
        }
    } catch (e) { console.error(`${soundKey} sesi çalınamadı.`, e); }
}

// YENİ: Oyunu bitiren fonksiyon
function endGame(isWin) {
    const overlay = document.getElementById('endGameOverlay');
    const title = document.getElementById('endGameTitle');
    const message = document.getElementById('endGameMessage');

    if (isWin) {
        title.textContent = '🥳 KAZANDIN! 🥳';
        message.textContent = `Tebrikler! Naz'ı çok mutlu ettin ve oyunu tamamladın!`;
        playSound('win');
    } else {
        title.textContent = '😥 KAYBETTİN! 😥';
        message.textContent = `Naz'ı çok üzdün. Bu sefer olmadı, ama pes etme!`;
        playSound('lose');
    }
    overlay.style.display = 'flex';
}

// YENİ: Oyunu yeniden başlatan fonksiyon
function restartGame() {
    const overlay = document.getElementById('endGameOverlay');
    overlay.style.display = 'none';

    // State'i sıfırla
    Object.assign(state, {
        moodIndex:3, ok:0, fail:0, streak:0, 
        winStreak: 0, loseStreak: 0
    });
    
    // Arayüzü güncelle
    okCountEl.textContent = state.ok;
    failCountEl.textContent = state.fail;
    streakEl.textContent = state.streak;

    renderMood();
    newQuestion();
    playSound('neutral');
}
function triggerAnimation(animationClass) {
  avatarEl.classList.add(animationClass);
  // Animasyon bitince sınıfı temizle ki tekrar tetiklenebilsin
  avatarEl.addEventListener('animationend', () => {
    avatarEl.classList.remove(animationClass);
  }, { once: true });
}

    function setDifficultyByStreak(){const s=state.streak;state.difficulty=s>=8?3:s>=3?2:1;}
    function rng(min,max){return Math.floor(Math.random()*(max-min+1))+min}
    function newQuestion(){setDifficultyByStreak();let range=state.difficulty===1?10:state.difficulty===2?25:60;let a=rng(0,range),b=rng(0,range);const op=Math.random()<.5?'+':'-';if(op==='-'&&b>a)[a,b]=[b,a];state.current={a,b,op,answer:op==='+'?a+b:a-b};questionEl.innerHTML=`<div>${a}</div><div>${op}</div><div>${b}</div><div>=</div>`;answerInput.value='';setTimeout(()=>answerInput.focus(),0)}
    
    function applyResult(ok) {
    const moodBefore = state.moodIndex;
    const maxMoodIndex = MOODS.length - 1;

    if (ok) {
        state.ok++; state.streak++; state.moodIndex = Math.min(maxMoodIndex, state.moodIndex + 1); state.loseStreak = 0;
        if (moodBefore === maxMoodIndex) { state.winStreak++; }
        if (state.winStreak >= 3) { endGame(true); return true; } // Oyun bitti
        playSound('correct');
    } else {
        state.fail++; state.streak = 0; state.moodIndex = Math.max(0, state.moodIndex - 1); state.winStreak = 0;
        if (moodBefore === 0) { state.loseStreak++; }
        if (state.loseStreak >= 3) { endGame(false); return true; } // Oyun bitti
        playSound('wrong');
    }

    if (ok && moodBefore === maxMoodIndex) { triggerAnimation('avatar-jump'); } 
    else if (!ok && moodBefore === 0) { triggerAnimation('avatar-shake'); }
  
    okCountEl.textContent = state.ok;
    failCountEl.textContent = state.fail;
    streakEl.textContent = state.streak;
    renderMood();
    return false; // Oyun devam ediyor
}




    function handleSubmit() {
    const val = Number((answerInput.value || '').trim());
    if (Number.isNaN(val)) { answerInput.focus(); return }
    const ok = (val === state.current.answer);
    answerInput.style.outline = `2px solid ${ok ? 'var(--good)' : 'var(--bad)'}`;
    setTimeout(() => answerInput.style.outline = 'none', 180);
    
    const isGameOver = applyResult(ok); // applyResult'tan dönen değeri al
    if (!isGameOver) { // Sadece oyun bitmediyse yeni soru getir
        newQuestion();
    }
}
    // ESKİ event listener kodları
document.addEventListener('DOMContentLoaded', () => {
  // Event listeners
  submitBtn.addEventListener('click', handleSubmit);
  skipBtn.addEventListener('click', () => newQuestion());
  answerInput.addEventListener('keydown', e => { if (e.key === 'Enter') handleSubmit() });

  const restartBtn = document.getElementById('restartBtn');
  if (restartBtn) restartBtn.addEventListener('click', restartGame);

  // Başlangıç
  preloadImages();
  renderMood();
  newQuestion();      // Artık ilk soru yüklenir
  playSound('neutral');
});
  </script>

<div class="overlay" id="endGameOverlay" style="display: none;">
  <div class="end-game-card">
    <h2 id="endGameTitle"></h2>
    <p id="endGameMessage"></p>
    <button class="btn" id="restartBtn">Tekrar Başla</button>
  </div>
</div>

</body>
</html>
